<% include partials/header %>
<div class="container white" style="margin-top: 1%; padding: 1%">
    <div class="container">
        <% if(discharges !== [] && loas !== []) { %>
            <div class="row">
                <form action="/opcenter/requests" method="POST">
                    <h3>Load Requests</h3>

                    <div class="form-group">
                        <label for="type">Request Type</label>
                        <select class="form-control" id="type" name="type">
                            <option>All Requests</option>
                            <option>New Requests</option>
                        </select>
                    </div>

                    <div class="form-group"><button class="btn btn-success">Submit</button></div>
                </form>
            </div>
        <% } %>
    </div>


    <div class="table-header">
      <h3>User Requests</h3>
    </div>
    <table class="table white table-bordered table-sm" style="text-align: left;">
      <thead>
        <tr>
          <th scope="col">Request Type</th>
          <th scope="col">User</th>
          <th scope="col">Unit</th>
          <th scope="col">Open</th>
        </tr>
      </thead>
      <tbody>
      <% console.log(discharges); %>
    <% discharges.forEach(function(discharge) { %>
     <% for(var i = 0; i < users.length; i++) { %>
        <% if(users[i]._id == discharge.ownerID) { %>
          <% var user = users[i]; %>
          <tr>
          <td><%=discharge.requestType%></td>
          <td><%=user.username%></td>
          <% if(user.unit.squad == "" & user.unit.platoon == "" && user.unit.company == "") { %>
            <td></td>
            <% } else if(user.unit.squad == "") { %>
            <td><%=user.unit.platoon%>, <%=user.unit.company%></td>
            <% } else { %>
            <td><%=user.unit.squad%>, <%=user.unit.platoon%>, <%=user.unit.company%></td>
            <% } %>
            <td>
                <form action="/opcenter/viewrequest/<%=discharge._id%>" method="post">
                    <input class="form-control" type="hidden" name="requestType" value="Discharge">
                    <button class="btn btn-primary btn-sm">Open Request</button>
                    <input class="form-control" type="hidden" name="id" value="<%=user._id%>">
                </form>
            </td>
        </tr>
        <% } %>
      <% } %>
    <% }) %>
    <% loas.forEach(function(loa) { %>
        <% for(var i = 0; i < users.length; i++) { %>
            <%  if(loa.read == false) { %>
                <% if(users[i]._id == loa.ownerID) { %>
                    <% var user = users[i]; %>
                    <tr>
                        <td><%=loa.requestType%></td>
                        <td><%=user.username%></td>
                        <% if(user.unit.squad == "" & user.unit.platoon == "" && user.unit.company == "") { %>
                            <td></td>
                        <% } else if(user.unit.squad == "") { %>
                        <td><%=user.unit.platoon%>, <%=user.unit.company%></td>
                        <% } else { %>
                        <td><%=user.unit.squad%>, <%=user.unit.platoon%>, <%=user.unit.company%></td>
                        <% } %>
                        <td>
                            <form action="/opcenter/viewrequest/<%=loa._id%>" method="post">
                                <button class="btn btn-primary btn-sm">Open Request</button>
                                <input class="form-control" type="hidden" name="id" value="<%=user._id%>">
                                <input class="form-control" type="hidden" name="requestType" value="Leave">
                            </form>
                        </td>
                    </tr>
                <% } %>
            <% } %>
        <% } %>
    <% }) %>
    </table>
</div>

<% include partials/footer %>